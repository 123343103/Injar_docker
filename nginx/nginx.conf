#设置nginx运行用户
user  nobody;

#nginx进程数，建议设置为CPU总核心数
worker_processes  4;

#错误日志文件
error_log  logs/error.log;
error_log  logs/error.log  notice;
error_log  logs/error.log  info;

#进程pid文件
pid        logs/nginx.pid;

#Events模块，设置工作模式等
events {
	#单个进程最大连接数
    worker_connections  1024;
}

#Http模块
http {
	#文件扩展名与文件类型映射表
    include       mime.types;

	#默认文件类型
    default_type  application/octet-stream;

	#开启高效文件传输模式
    sendfile        on;

	#长连接超时时间，单位是秒
    keepalive_timeout  65;

	#开启目录列表访问，合适下载服务器，默认关闭
	#autoindex		on;

	#虚拟主机的配置
    server {
        listen       80;
        server_name  local-api.injar.cn;
		root   /usr/local/nginx/html/yingjia_admin/admin;
        index  index.html index.htm index.php;
		location ~ \.php {
        	fastcgi_pass  php-fpm:9000;
  			fastcgi_index index.php;
  			set $path_info "";
  			set $real_script_name $fastcgi_script_name;
  			if ($fastcgi_script_name ~ "^(.+?\.php)(/.+)$") {
    			set $real_script_name $1;
 	   			set $path_info $2;
			}
  			fastcgi_param SCRIPT_FILENAME $document_root$real_script_name;
  			fastcgi_param SCRIPT_NAME $real_script_name;
  			fastcgi_param PATH_INFO $path_info;
  			include    fastcgi_params;
		}
    }

	
    server {
        listen       80;
        server_name  local-wx.injar.cn;
		root   /usr/local/nginx/html/yingjia_website;
        index  index.html index.htm index.php;
		location / {                
                # 这个可以把index.php去掉  就是demo.com/module/controller/action的形式
                try_files $uri $uri/ /$query_string;
            }
            
            location ~ \.php(.*)$ {
                # 转发端口
                fastcgi_pass   php-fpm:9000;
                fastcgi_index  index.php;
                # 这边要求必须有两个捕获组
                fastcgi_split_path_info  ^(.+\.php)(/?.+)$;
                # 下面这个要求 /script 替换成 $document_root ，否则会出现 404 错误
                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
                fastcgi_param  PATH_INFO  $fastcgi_path_info;
                fastcgi_param  PATH_TRANSLATED  $document_root$fastcgi_path_info;
                include        fastcgi_params;
            }	
    }
}
